<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <th:block th:include="include :: header('基础信息列表')" />
    <th:block th:include="include :: datetimepicker-css" />
</head>
<body class="white-bg">
    <div class="wrapper wrapper-content animated fadeInRight ibox-content">
        <form class="form-horizontal m" id="form-baseInfo-edit" th:object="${cmBaseInfo}">
            <input name="baseId" type="hidden" th:field="*{baseId}" >


            <div class="ibox-content">

                <div class="row">
                    <div class="col-sm-12">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                基础配置项
                            </div>
                            <div class="panel-body">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">网站名称：</label>
                                        <div class="col-sm-9">
                                            <input type="text" name="name" th:field="*{name}" class="form-control" placeholder="请输入网站名称" required maxlength="30">
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">新浪微博：</label>
                                        <div class="col-sm-9">
                                            <input type="text" name="xlBlog" th:field="*{xlBlog}" class="form-control" placeholder="请输入新浪微博" required maxlength="30">
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">公众微信：</label>
                                        <div class="col-sm-9">
                                            <input type="text" name="wxName" th:field="*{wxName}" class="form-control" placeholder="请输入公众微信" required maxlength="30">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">联系电话：</label>
                                        <div class="col-sm-9">
                                            <input type="text" name="iphone" th:field="*{iphone}" class="form-control" placeholder="请输入联系电话" required maxlength="15">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">备案：</label>
                                        <div class="col-sm-9">
                                            <input type="text" name="icp" th:field="*{icp}" class="form-control" placeholder="请输入备案" maxlength="30">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">地址：</label>
                                        <div class="col-sm-9">
                                            <input type="text" name="address" th:field="*{address}" class="form-control" placeholder="请输入地址" maxlength="100">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">网址：</label>
                                        <div class="col-sm-9">
                                            <input type="url" name="website" th:field="*{website}" class="form-control" placeholder="请输入网址" required maxlength="30">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">腾讯微博：</label>
                                        <div class="col-sm-9">
                                            <input type="text" name="txBlog" th:field="*{txBlog}" class="form-control" placeholder="请输入腾讯微博" maxlength="30">
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">QQ：</label>
                                        <div class="col-sm-9">
                                            <input type="text" name="qq" th:field="*{qq}" class="form-control" placeholder="请输入QQ" maxlength="20">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">传真：</label>
                                        <div class="col-sm-9">
                                            <input type="text" name="fax" th:field="*{fax}" class="form-control" placeholder="请输入传真" required maxlength="30">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">邮箱：</label>
                                        <div class="col-sm-9">
                                            <input type="email" name="email" th:field="*{email}" class="form-control" placeholder="请输入邮箱" maxlength="30">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">logo：</label>
                                        <div class="col-sm-9">
                                            <div class="col-sm-9">
                                                <input type="hidden" id="logo" name="logo" th:field="*{logo}">
                                                <div class="imageBox" onclick="changeImg(this)" th:data-key="*{logo}" data-id="logo" data-ratio="4.375">
                                                    <img  th:src="(${#strings.isEmpty(logoUrl)}) ? @{/img/profile.jpg} : @{${logoUrl}}" style="max-width: 330px;">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>

                        </div>
                    </div>

                </div>
            </div>


            <div class="ibox-content">

                <div class="row">
                    <div class="col-sm-12">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                               收支配置
                            </div>
                            <div class="panel-body">
                                <div class="col-md-6">

                                    <!--捐赠信息设置-->
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">捐赠截止日期：</label>
                                        <div class="col-sm-8">
                                            <div class="input-group date">
                                                <input name="dTime" th:value="${#dates.format(cmBaseInfo.dTime, 'yyyy-MM-dd')}" class="form-control"
                                                       placeholder="yyyy-MM-dd" type="text">
                                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">捐赠总收入：</label>
                                        <div class="col-sm-8">
                                            <input name="dTotalSum" th:field="*{dTotalSum}" class="form-control" type="text">
                                        </div>
                                    </div>


                                </div>

                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">捐赠总人数：</label>
                                        <div class="col-sm-8">
                                            <input name="dCount" th:field="*{dCount}" class="form-control" type="text">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">捐赠总支出：</label>
                                        <div class="col-sm-8">
                                            <input name="dTotalOut" th:field="*{dTotalOut}" class="form-control" type="text">
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="ibox-content">

                <div class="row">
                    <div class="col-sm-12">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                二维码管理
                            </div>
                            <div class="panel-body">
                                <div class="col-md-6">

                                    <div class="form-group">
                                        <label class="col-sm-3 control-label is-required">微信捐赠二维码：</label>
                                        <div class="col-sm-8">
                                            <input type="hidden" name="orphanZhifubao" id="orphanZhifubao" th:field="*{orphanZhifubao}" >
                                            <div class="imageBox" onclick="changeImg(this)" th:data-key="*{orphanZhifubao}" data-id="orphanZhifubao" data-ratio="1">
                                                <img th:src="(${#strings.isEmpty(orphanZUrl)}) ? @{/img/profile.jpg} : @{${orphanZUrl}}" style="max-width: 330px;">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label is-required">成美腾讯公益首页二维码：</label>
                                        <div class="col-sm-8">
                                            <input type="hidden" name="girlWeixin" id="girlWeixin" th:field="*{girlWeixin}" >
                                            <div class="imageBox" onclick="changeImg(this)" th:data-key="*{girlWeixin}" data-id="girlWeixin" data-ratio="1">
                                                <img th:src="(${#strings.isEmpty(girlWUrl)}) ? @{/img/profile.jpg} : @{${girlWUrl}}" style="max-width: 330px; object-fit:contain">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">微信分享二维码：</label>
                                        <div class="col-sm-9">
                                            <input type="hidden" name="wxImg" id="wxImg" th:field="*{wxImg}" >
                                            <div class="imageBox" onclick="changeImg(this)" th:data-key="*{wxImg}" data-id="wxImg" data-ratio="1">
                                                <img th:src="(${#strings.isEmpty(wxImgUrl)}) ? @{/img/profile.jpg} : @{${wxImgUrl}}" style="max-width: 330px; object-fit:contain">
                                            </div>
                                        </div>
                                    </div>


                                </div>

                                <div class="col-md-6">


                                    <!--二维码管理-->
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label is-required">支付宝捐赠二维码：</label>
                                        <div class="col-sm-8">
                                            <input type="hidden" name="orphanWeixin" id="orphanWeixin" th:field="*{orphanWeixin}" >
                                            <div class="imageBox" onclick="changeImg(this)" th:data-key="*{orphanWeixin}" data-id="orphanWeixin" data-ratio="1">
                                                <img th:src="(${#strings.isEmpty(orphanWUrl)}) ? @{/img/profile.jpg} : @{${orphanWUrl}}" style="max-width: 330px; object-fit:contain">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="col-sm-3 control-label is-required">成美支付宝公益首页二维码：</label>
                                        <div class="col-sm-8">
                                            <input type="hidden" name="girlZhifubao" id="girlZhifubao" th:field="*{girlZhifubao}" >
                                            <div class="imageBox" onclick="changeImg(this)" th:data-key="*{girlZhifubao}" data-id="girlZhifubao" data-ratio="1">
                                                <img th:src="(${#strings.isEmpty(girlZUrl)}) ? @{/img/profile.jpg} : @{${girlZUrl}}" style="max-width: 330px; object-fit:contain">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-12">
                <div class="form-group">
                    <div class="col-sm-offset-6 col-sm-12">
                        <button type="button" class="btn btn-sm btn-primary" onclick="submitBaseInfo()"><i class="fa fa-check"></i>保 存</button>&nbsp;
                        <button type="button" class="btn btn-sm btn-danger" onclick="refreshBaseInfo()"><i class="fa fa-reply-all"></i>放 弃 </button>

                    </div>
                </div>
            </div>
        </form>
    </div>
    <th:block th:include="include :: footer" />
    <th:block th:include="include :: datetimepicker-js" />
    <script th:inline="javascript">
        var editFlag = [[${@permission.hasPermi('cm:baseInfo:edit')}]];

        var prefix = ctx + "cm/baseInfo";

        $("input[name='dTime']").datetimepicker({
            format: "yyyy-mm-dd",
            minView: "month",
            autoclose: true
        });

        function submitBaseInfo() {
            if ($.validate.form()) {
                $.operate.save(prefix + "/edit", $('#form-baseInfo-edit').serialize());
            }
        }
        function refreshBaseInfo(){
            refreshTab();
        }

        // 上传图片
        function changeImg(e){
            var imgId = $(e).attr("data-key");
            var domId = $(e).data("id");
            var aspectRatio = $(e).data("ratio"); // 剪切比例

            var url = ctx + 'cm/common/imgUpload?imgId=' + imgId +"&aspectRatio=" + aspectRatio;

            // 弹出一个框进行过图像上传
            top.layer.open({
                type: 2,
                area: [$(window).width()-600 + 'px', $(window).height() + 'px'],
                fix: false,
                //不固定
                maxmin: true,
                shade: 0.3,
                title: "修改头像",
                content: url,
                btn: ['确定', '关闭'],
                // 弹层外区域关闭
                shadeClose: true,
                yes: function(index, layero) {
                    var iframeWin = layero.find('iframe')[0];
                    // 回调submitHandler方法将图片信息上传上去
                    iframeWin.contentWindow.submitHandler(index, layero, domId,"baseInfo");
                },
                cancel: function(index) {
                    return true;
                }
            });
        }
        function setImg(result,domId){
            if (result.code == web_status.SUCCESS) {

                $("#" + domId).val(result.cmFileInfo.fId);
                $("#" + domId).next().attr("data-key",result.cmFileInfo.fId);
                $("#" + domId).next().children()[0].src =result.cmFileInfo.fileUrl;

            } else if (result.code == web_status.WARNING) {
                $.modal.alertWarning(result.msg)
            } else {
                $.modal.alertError(result.msg);
            }
        }

    </script>
</body>
</html>